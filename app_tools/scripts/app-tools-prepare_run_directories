
#!/bin/bash

if [ $# -lt 1 ]; then
    echo "Usage: $0 <folder> [nsubfolders]"
    echo "  <folder>      : Directory in which to create or list subfolders"
    echo "  [nsubfolders] : (Optional) Number of subfolders to create in each directory"
    echo "Creates subfolders for all subfolders in the specified directory and lists them in folder.txt."
    exit 1
fi

PREFIX="${1%/}"

if [ -f "run_directories.txt" ]; then
    rm "run_directories.txt"
fi

if [ -d "$PREFIX" ]; then
    if [ -z "$2" ]; then
        for dir in "$PREFIX"/*; do
            echo "$dir" >> "run_directories.txt"
        done
    else
        n="$2"
        width=${#n}
        (( width < 2 )) && width=2
        
        for dir in "$PREFIX"/*; do
            if [ -d "$dir" ] && [ "$(find "$dir" -mindepth 1 -maxdepth 1 -type d | wc -l)" -gt 0 ]; then
                echo "Skipping $dir (already has subfolders)"
                continue
            fi
            
            if [ -d "$dir" ]; then
                for ((i=0; i<n; i++)); do
                    sub_dir=$(printf "$dir/%0${width}d" "$i")
                    mkdir "$sub_dir"
                    echo "Created: $sub_dir"
                    echo "$sub_dir" >> "run_directories.txt"
                done
            fi
        done
    fi
else
    echo "No directory named $PREFIX!"
    exit 1
fi
